# AGENTS.md（Codex / 自動実装エージェント向け運用ルール）
このリポジトリで作業するエージェントは、必ず本ファイルの指示に従うこと。

## 参照する一次情報（優先順）
1. docs/requirements.md（要件定義）
2. docs/codex-constitution.md（Codex憲法）
3. 本ファイル（運用ルール）

## 言語ルール（最重要）
- **コミットメッセージは必ず日本語**で書く
- **PRタイトルは必ず日本語**
- **PR本文（概要/変更点/テスト手順/懸念点）も必ず日本語**
- **コード内コメントも原則日本語**（ただしライブラリ由来の英語は除く）
- UI文言は docs/requirements.md の「表記ルール」に厳密に従う（勝手に言い換えない）

## コミットメッセージ規約（接頭辞）
- コミットメッセージは以下の形式に統一する（**日本語**で書く）：
  - `type: 要約`
  - 例：`feat: ログイン画面を追加`

### 使用する type 一覧
- `feat`: 機能追加
- `fix`: バグ修正
- `docs`: ドキュメントのみ変更
- `style`: フォーマット/空白/セミコロン等（挙動に影響なし）
- `refactor`: リファクタ（機能変更なし）
- `perf`: パフォーマンス改善
- `test`: テスト追加/修正
- `build`: ビルド関連（Vite設定、依存更新など）
- `ci`: CI関連（GitHub Actions等）
- `chore`: 雑務（設定・スクリプト・生成物の整理など）
- `revert`: 差し戻し

### 追加ルール
- 1コミットは1目的（混ぜない）
- 50文字目安で短く（日本語で）
- 「〜します」「〜しました」より、名詞＋動詞で端的に（例：`テンプレ詳細の表示を追加`）

## PR運用
- 1PR = 1機能 または 1〜2画面まで
- PRには必ず以下を含める（日本語で）
  - 変更点サマリ（3〜7行）
  - 主要な変更ファイル一覧
  - 手動テスト手順（3〜7項目）
  - 既知の未対応/懸念点

## 禁止事項
- MVPスコープ外の機能追加（通知/期日/共有/課金/AI等）
- 不要な依存関係の大量追加
- UI表記ルールの破壊（TODO/タスク/テンプレート等の語をユーザー向け表示に使う）

## Codex向け Playwright MCP 操作手順
本リポジトリでは `@playwright/mcp` を導入済み。Codex からブラウザ操作を行う際は以下を守ること。

1. **開発サーバーを起動**  
   `make dev`（従来どおり `docker compose up web vite ssr` でも可）を実行し、`http://localhost:3400` にアクセスできる状態にする。
2. **MCP サーバーを起動**  
   `make dev-mcp`（=`yarn mcp:playwright`）で Playwright MCP を立ち上げる。終了時は Ctrl+C で停止。  
   開発サーバーと MCP を同時に立ち上げる場合は `make up` を利用すると 1 コマンドで起動できる。
3. **Codex CLI への登録**  
   `~/.codex/config.toml` に以下を追記し、Codex からサーバーを呼び出せるようにする。
   ```
   [mcp_servers.playwright]
   command = "yarn"
   args = ["mcp:playwright"]
   ```
4. **操作時の注意**  
   - `browser_navigate` などの MCP ツールは、既に起動済みの `yarn mcp:playwright` プロセスを利用する。  
   - UI 文言・禁止ワードのチェックは docs/requirements.md / このファイルの規約を必ず参照。  
   - ブラウザ操作ログやスクリーンショットは `tmp/playwright-mcp/` に保存されるため、不要になったら適宜削除してよい。

補足：
- `make shell` を実行すると `web` コンテナに入り、必要なコマンドを直接実行できる。作業が終わったら `exit` で抜けること。

## GitHub Issue / PR 作成時の注意
- `gh` コマンドなどで Issue / PR を作成・編集する際は、本文をファイルに書き出してから `--body-file` を利用し、改行が `\n` として扱われる事態を防ぐ。  
- 直接引数で渡す場合もヒアドキュメントや `printf` ではなく、ファイル経由で安全に Markdown を反映させること。
