#!/usr/bin/env bash
set -euo pipefail

echo "Starting docker compose (web + vite + ssr) and Playwright MCP..."

cleanup() {
  echo "Stopping services..."
  if [[ -n "${MCP_PID:-}" ]] && kill -0 "$MCP_PID" 2>/dev/null; then
    kill "$MCP_PID" || true
    wait "$MCP_PID" || true
  fi

  if [[ -n "${COMPOSE_PID:-}" ]] && kill -0 "$COMPOSE_PID" 2>/dev/null; then
    kill "$COMPOSE_PID" || true
    wait "$COMPOSE_PID" || true
  fi

  docker compose down >/dev/null 2>&1 || true
}

trap cleanup INT TERM EXIT

docker compose up web vite ssr &
COMPOSE_PID=$!

yarn mcp:playwright &
MCP_PID=$!

wait "$COMPOSE_PID" "$MCP_PID"
